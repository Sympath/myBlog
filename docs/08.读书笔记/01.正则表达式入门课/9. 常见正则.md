---
title:  常见正则
date: 2022-01-17 17:31:38
permalink: /pages/b6aef0/
categories:
  - 读书笔记
  - 正则表达式入门课
tags:
  - 
---
### 前言

​		正则处理问题的基本思路。有一些方法比较固 定，比如将问题分解成多个小问题，每个小问题见招拆招:某个位置上可能有多个字符的 话，就用字符组。某个位置上有多个字符串的话，就用多选结构。出现的次数不确定的 话，就用量词。对出现的位置有要求的话，就用锚点锁定位置。 ` 								 									`在正则中比较难的是某些字符不能出现，这个情况又可以进一步分为组成中不能出现，和 要查找的内容前后不能出现。后一种用环视来解决就可以了。我们主要说一下第一种。

​		如果是要查找的内容中不能出现某些字符，这种情况比较简单，可以通过使用中括号来排 除字符组，比如非元音字母可以使用` [^aeiou]`来表示。

​		如果是内容中不能出现某个子串，比如要求密码是 6 位，且不能有连续两个数字出现。假 设密码允许的范围是 \w，你应该可以想到使用 \w{6} 来表示 6 位密码，但如果里面不能有 连续两个数字的话，该如何限制呢?这个可以环视来解决，就是每个字符的后面都不能是 两个数字(要注意开头也不能是 \d\d)，下面是使用 Python3 语言测试的示例。

```
/^((?!\d\d)\w){6}$/
```

在写完正则后，我们可以通过一些工具去调试，先要确保正则满足功能需求，再看一下有 没有性能问题， 如果功能不正确，性能考虑再多其实也没用。

### 常见问题及解决方案

##### 匹配数字

​		数字的匹配比较简单，通过我们学习的字符组，量词等就可以轻松解决。

- 如果是连续的多个数字，可以使用 \d+ 或 [0-9]+
- 如果 n 位数据，可以使用 \d{n}。
- 如果是至少 n 位数据，可以使用 \d{n,}。
- 如果是 m-n 位数字，可以使用 \d{m,n}。

##### 匹配正数、负数和小数

如果希望正则能匹配到比如 3，3.14，-3.3，+2.7 等数字，需要注意的是，开头的正负符 号可能有，也可能没有，所以可以使用 [-+]? 来表示，小数点和后面的内容也不一定会 有，所以可以使用 (?:\.\d+)? 来表示，因此匹配正数、负数和小数的正则可以写成 [- +]?\d+(?:\.\d+)?。

- 非负整数，包含 0 和 正整数，可以表示成[1-9]\d*|0。

- 非正整数，包含 0 和 负整数，可以表示成-[1-9]\d*|0。

##### 浮点数

- 负数浮点数表示`/-\d+(?:\.\d+)?/`

- 正数浮点数表示:`/\+?(?:\d+(?:\.\d+)?|\.\d+)/`

##### 十六进制数

**推荐正则**：`/[0-9A-Fa-f]+/`

**说明：**十六进制的数字除了有 0-9 之外，还会有 a-f(或 A-F) 代表 10 到 15 这 6 个数字；

##### 手机号码

**推荐正则**：`/1[3-9]\d{9}/`

**说明：**我们可以简单地使用字符组和多选分支，来准确地匹配手机号段。如果只限制前 2 位，可 以表示成 ，如果想再精确些，限制到前三位，比如使用1(?:3\d|4[5- 9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[1389])\d{8}来表示。如果想精确到 4 位，甚至 5 位，可以根据公开的号段信息自己来写一下，但要注意的是，越是精确，只要 有新的号段，你就得改这个正则，维护起来会比较麻烦。另外，在实际运用的时候，你可 能还要考虑一下有一些号码了 +86 或 0086 之类的前缀的情况。



##### 身份证号码

**推荐正则**：`[1-9]\d{14}(\d\d[0-9Xx])?`

**说明：**我国的身份证号码是分两代的，第一代是 15 位，第二代是 18 位。如果是 18 位，最后一 位可以是 X(或 x)，两代开头都不能是 0，根据规则，你应该能很容易写出相应的正则， 第一代可以用 [1-9]\d{14} 来表示，第二代比第一代多 3 位数据，可以使用量词 0 到 1 次，即写成

##### 邮政编码

**推荐正则**：`[1-9]\d{5}`

**说明：**邮编一般为 6 位数字，首位不是 0，比较简单，可以写成 ，之前我们也提到 过，6 位数字在其它情况下出现可能性也非常大，比如手机号的一部分，身份证号的一部 分，所以如果是数据提取，一般需要添加断言，即写成 (?<!\d)[1-9]\d{5}(?!\d)。

##### 腾讯 QQ 号码

**推荐正则**：`[1-9][0-9]{4,9}`

**说明：**目前 QQ 号不能以 0 开头，最长的有 10 位，最短的从 10000(5 位)开始。从规则上我 们可以得知，首位是 1-9，后面跟着是 4 到 9 位的数字

##### 中文字符

**推荐正则**：`[\u4E00-\u9FFF]`

**说明：**中文属于多字节 Unicode 字符，之前我们讲过比如通过 Unicode 属性，但有一些语言是 不支持这种属性的，可以通过另外一个办法，就是码值的范围，中文的范围是 4E00 - 9FFF 之间，这样可以覆盖日常使用大多数情况。

不同的语言是表示方式有一些差异，比如在 Python，Java，JavaScript 中，Unicode 可 以写成 \u码值 来表示，即匹配中文的正则可以写成 [\u4E00-\u9FFF]，如果在 PHP 中使 用，Unicode 就需要写成 **\u{码值}** 的样式。下面是在 Python3 语言中测试的示例，你可 以参考一下。

##### IPv4 地址

**推荐正则：** ` \d{1,3}(\.\d{1,3}){3}`

**说明：**IPv4 地址通常表示成 27.86.1.226 的样式，4 个数字用点隔开，每一位范围是 0-255，比 如从日志中提取出 IP

##### 日期和时间

**推荐正则：** `\d{4}-\d{2}-\d{2}`  或 `\d{4}-(?:1[0-2]|0?[1-9])-(?:[12]\d|3[01]|0?[1-9])`

**说明：** 假设日期格式是 yyyy-mm-dd，如果不那么严格，我们可以直接使用 。 如果再精确一些，比如月份是 1-12，当为一位的时候，前面可能不带 0，可以写成 01 或 1，月份使用正则，可以表示成 1[0-2]|0?[1-9]，日可能是 1-31，可以表示成 [12]\d|3[01]|0?[1-9]，这里需要注意的是 0?[1-9] 应该放在多选分支的最后面，因 为放最前面，匹配上一位数字的时候就停止了

##### 邮箱

**推荐正则：** `[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+`

**说明：** 邮箱的组成是比较复杂的，格式是 用户名 @主机名，用户名部分通常可以有英文字母，数 字，下划线，点等组成，但其中点不能在开头，也不能重复出现。



### 总结

​		好了，今天的内容讲完了，我来带你总结回顾一下，今天我们了解了下正则处理问题的基本思路，通常是将问题拆解成多个小问题，每个小问题见招拆招：

- 某个位置上可能是多个单字符就用字符组
- 某个位置上可能是多个字符串就用多选结构，出现次数不确定就用量词
- 出现的位置有要求就用断言。

遇到问题，你遵循这些套路，写出正则其实并不难。我们从一些日常的问题入手，详细地讲解了一些常见的案例，也讲解了可能会遇到的一些坑，比如在使用多选结构时要注意的问题，你在后续工作中要注意避开这些问题。


